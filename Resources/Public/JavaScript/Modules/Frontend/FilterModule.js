define(["TYPO3/CMS/In2studyfinder/Utility/UiUtility","TYPO3/CMS/In2studyfinder/Utility/UrlUtility","TYPO3/CMS/In2studyfinder/Utility/AjaxUtility"],function(e,t,i){"use strict";var r={identifiers:{in2studyfinderContainer:".in2studyfinder",filterForm:".js-in2studyfinder-filter",filterContainer:".js-in2studyfinder-filter-options",filterFieldset:".js-in2studyfinder-filter-section",filterLegend:".js-in2studyfinder-filter-legend",filterCheckbox:".in2studyfinder-js-checkbox",filterCheckboxAll:".in2studyfinder-js-checkbox-all",showFilterButton:".js-in2studyfinder-filter-button-show",hideFilterButton:".js-in2studyfinder-filter-button-reset",hideElement:".u-in2studyfinder-hide",isHidden:".is-hidden"},filter:[]};return r.initialize=function(){r.setEventListener(),r.prepareFilter()},r.prepareFilter=function(){r.prepareCheckboxes(),r.filter.length>0&&r.filter.forEach(function(t){r.toggleFilterVisibility();var i=document.querySelector('[data-filtergroup="'+t+'"]'),n=i.querySelector(r.identifiers.filterContainer);e.toggleClassForElement(n,r.identifiers.isHidden.substr(1))})},r.setEventListener=function(){var e=document.querySelector(r.identifiers.hideFilterButton);e.addEventListener("click",r.toggleFilterVisibility);var t=document.querySelector(r.identifiers.showFilterButton);t.addEventListener("click",r.toggleFilterVisibility),r.setFilterVisibilityEventListener(),r.setFilterCheckboxEventListener()},r.setFilterCheckboxEventListener=function(){document.querySelector(".c-in2studyfinder-filter__sections").addEventListener("click",function(e){var t=e.target;if("INPUT"===t.tagName){if(t.classList.contains(r.identifiers.filterCheckboxAll.substr(1))){var i=t.parentNode;r.resetFilter(i)}if(t.classList.contains(r.identifiers.filterCheckbox.substr(1))){var n=t.parentNode.querySelector(r.identifiers.filterCheckboxAll);n.checked=!1,n.disabled=!1}r.updateFilter()}})},r.resetFilter=function(e){var t=e.querySelector(r.identifiers.filterCheckboxAll),i=e.querySelectorAll(r.identifiers.filterCheckbox);t.checked=!0,t.disabled=!0,i.forEach(function(e){e.checked=!1})},r.updateFilter=function(){var i=document.querySelector(r.identifiers.in2studyfinderContainer),n=document.querySelector(r.identifiers.filterForm),l=i.getAttribute("data-plugin-uid"),o=i.getAttribute("data-in2studyfinder-language"),s=1,d="",c="",f="";"undefined"!=typeof l&&(d="&ce="+l),"undefined"!=typeof o&&null!==o&&(c="&L="+o),"undefined"!=typeof s&&(f="&tx_in2studyfinder_pi1[@widget_0][currentPage]="+s);var u="/?type=1308171055&studyFinderAjaxRequest=1"+d+c+f,a=new XMLHttpRequest;a.onreadystatechange=function(){if(1===this.readyState&&e.enableLoader(),4===this.readyState&&200===this.status){var t=document.createElement("div");t.innerHTML=a.responseText,document.querySelector(r.identifiers.in2studyfinderContainer).parentNode.replaceChild(t.querySelector(r.identifiers.in2studyfinderContainer),document.querySelector(r.identifiers.in2studyfinderContainer));var i=require("TYPO3/CMS/In2studyfinder/Frontend");i.initialize(),e.disableLoader()}},a.open("POST",u,!0),a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.send(t.serialize(n))},r.setSelectedFilterToUrl=function(e){var t={},i="",n=document.querySelector(r.identifiers.filterForm),l=n.querySelectorAll(r.identifiers.filterCheckbox+":checked");l.forEach(function(e){console.log(e)}),console.log(l);var o=$(".js-in2studyfinder-filter").find("input.in2studyfinder-js-checkbox:checked");$(o).each(function(){var e=$(this).closest("fieldset").data("filtergroup");void 0===t[e]&&(t[e]=[]),t[e].push($(this).val())}),$(t).each(function(e,t){$.each(t,function(e,t){i+=e+"--",$.each(t,function(e,t){i+=t+"+"}),i=i.replace(/\+$/,""),i+="__"}),i=i.replace(/__$/,"")}),e&&(i+="page="+e),window.location=location.protocol+"//"+location.host+location.pathname+(location.search?location.search:"")+"#"+i},r.getSelectedFilterFromUrl=function(){var e=window.location.hash.split("#");if(1 in e){e=e[1];var t;if(e.indexOf("page=")!==-1&&(t=e.split("page=")[1],e=e.split("page=")[0]),""!==e){var i=e.split("__");$(i).each(function(e,t){var i="--",r=t.split(i),n=t.substr(0,t.indexOf(i)),l=r[1].split("+");$(l).each(function(e,t){$("#"+n+"_"+t).prop("checked",!0)})})}return t}},r.setFilterVisibilityEventListener=function(){var t=document.querySelectorAll(r.identifiers.filterFieldset);t.forEach(function(t){t.querySelector(r.identifiers.filterLegend).addEventListener("click",function(){var i=t.querySelector(r.identifiers.filterContainer);e.toggleClassForElement(i,r.identifiers.isHidden.substr(1))})})},r.toggleFilterVisibility=function(){document.querySelectorAll(r.identifiers.filterFieldset).forEach(function(t){e.toggleClassForElement(t,r.identifiers.hideElement.substr(1))});var t=document.querySelector(r.identifiers.showFilterButton),i=document.querySelector(r.identifiers.hideFilterButton);e.toggleClassForElement(t,r.identifiers.hideElement.substr(1)),e.toggleClassForElement(i,r.identifiers.hideElement.substr(1))},r.prepareCheckboxes=function(){document.querySelectorAll(r.identifiers.filterContainer).forEach(function(e){var t=r.isFilterSet(e);if(t){r.filter.push(e.parentNode.getAttribute("data-filtergroup"));var i=e.querySelector(r.identifiers.filterCheckboxAll);i.checked=!1,i.disabled=!1}})},r.isFilterSet=function(e){var t=!1;return e.querySelectorAll(r.identifiers.filterCheckbox).forEach(function(e){e.checked&&(t=!0)}),t},r});